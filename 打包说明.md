# 二维码扫描器 - 打包说明

## 项目结构

```
二维码系列/
├── 二维码扫描器.py          # 主程序（单文件）
├── fonts/                    # 字体文件夹
│   ├── msyh.ttc             # 微软雅黑
│   ├── simhei.ttf           # 黑体
│   ├── simsun.ttc           # 宋体
│   ├── arial.ttf            # Arial
│   └── calibri.ttf          # Calibri
└── 打包说明.md              # 本文件
```

## 环境要求

### 1. 安装Python依赖

```bash
pip install kivy opencv-python pyzbar Pillow numpy
```

### 2. 电脑端运行

直接运行：
```bash
python 二维码扫描器.py
```

## Android APK打包步骤

### 方法一：使用Buildozer（推荐）

#### 1. 安装Buildozer

```bash
pip install buildozer
```

#### 2. 创建buildozer.spec配置文件

在项目根目录创建 `buildozer.spec` 文件：

```ini
[app]
title = 二维码扫描器
package.name = qrscanner
package.domain = org.example
source.dir = .
source.include_exts = py,png,jpg,kv,atlas,ttf,ttc
version = 1.0
requirements = python3,kivy,opencv-python,pyzbar,Pillow,numpy,pyjnius
orientation = portrait
fullscreen = 0
android.permissions = CAMERA,INTERNET,WRITE_EXTERNAL_STORAGE,READ_EXTERNAL_STORAGE
android.api = 33
android.minapi = 21
android.arch = armeabi-v7a
```

#### 3. 安装Android SDK和NDK

- 下载 Android SDK Command Line Tools
- 设置环境变量 `ANDROID_SDK_ROOT`
- 安装必要组件：
  ```bash
  sdkmanager "platform-tools" "platforms;android-33" "build-tools;33.0.0" "ndk;25.2.9519653"
  ```

#### 4. 构建APK

```bash
buildozer android debug
```

构建完成后，APK文件位于：`./bin/二维码扫描器-1.0-armeabi-v7a_debug.apk`

### 方法二：使用Python-for-Android

#### 1. 安装依赖

```bash
pip install python-for-android
```

#### 2. 构建APK

```bash
p4a apk --private . --package=org.example.qrscanner --name "二维码扫描器" --version 1.0 --bootstrap=sdl2 --requirements=python3,kivy,opencv-python,pyzbar,Pillow,numpy --arch=armeabi-v7a --permission=CAMERA --permission=INTERNET --permission=WRITE_EXTERNAL_STORAGE
```

## 功能说明

### 主要功能

1. **摄像头扫描**
   - 调用设备摄像头实时扫描
   - 自动识别二维码并解析
   - 扫描框提示

2. **图片扫描**
   - 从相册选择图片
   - 识别图片中的二维码

3. **结果显示**
   - 在界面上显示解析内容
   - 显示二维码类型

4. **保存功能**
   - 保存解析内容到文本文件
   - 自动分类（URL/文本/图片）

5. **复制功能**
   - 一键复制解析内容到剪贴板

6. **历史记录**
   - 自动保存扫描历史
   - 查看和清除历史记录

### 界面布局

- **标签页1：摄像头扫描** - 实时摄像头扫描
- **标签页2：图片扫描** - 从图片文件扫描
- **标签页3：历史记录** - 查看扫描历史

## 字体配置

程序会自动加载 `fonts` 文件夹中的字体文件：
- 微软雅黑（MicrosoftYaHei）- 主界面字体
- 黑体（SimHei）- 备用字体
- 宋体（SimSun）- 备用字体
- Arial - 英文字体
- Calibri - 英文字体

## 注意事项

1. **摄像头权限**：Android设备需要授予摄像头权限
2. **存储权限**：保存功能需要存储权限
3. **字体显示**：如果中文字体显示异常，请确保fonts文件夹存在且字体文件完整
4. **性能优化**：扫描时建议将二维码对准屏幕中央的扫描框

## 常见问题

### Q: 程序无法启动？
A: 检查是否安装了所有依赖库：`pip install kivy opencv-python pyzbar Pillow numpy`

### Q: 摄像头无法打开？
A: 检查摄像头权限是否已授予，或其他程序是否占用了摄像头

### Q: 中文显示乱码？
A: 确保fonts文件夹中的字体文件存在且未损坏

### Q: APK打包失败？
A: 检查Android SDK和NDK是否正确安装，环境变量是否配置正确

## 更新日志

### v1.0.0
- 初始版本
- 支持摄像头扫描和图片扫描
- 支持保存和复制功能
- 支持历史记录
